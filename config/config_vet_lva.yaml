# Event-specific configuration for BVA events
# This configuration file contains all event-specific settings and output file names
# 15122025 test control group
mode: "personal_agendas"  # can be engagement or personal_agendas
# Event configuration 
event:
  name: "lva"
  main_event: "lva"
  main_event_name: "lva"  # This will trigger vet-specific functions
  secondary_event_name: "bva"
  year: 2025
  shows_this_year:
    - "LVS25"
  shows_last_year_main:
    - "LVS24"
  shows_last_year_secondary:
    - "BVA2025"

# Documentation assets surfaced by the application
documentation:
  generic_pipeline_map: "docs/generic_pipeline_map.svg"
  show_pipeline_map: "docs/vet_pipeline_map.svg"

post_analysis_mode:
  registration_shows:
    this_year_main:
      - ['LVS25']
  scan_files:
    seminars_scan_reference_this: "data/lva/post/lvs25 seminar scans reference.csv"
    seminars_scans_this: "data/lva/post/lvs25 seminar scans.csv"
  entry_scan_files:
    entry_scans_this: ["data/lva/post/lvs25_unfiltered_entry_scans.csv"]  

# Badge history column names
badge_history_columns:
  main_event: "BadgeId_last_year_bva"
  secondary_event: "BadgeId_last_year_lva"

# Practice type column names for different years
practice_type_columns:
  current: "what_type_does_your_practice_specialise_in"
  past_bva: "what_areas_do_you_specialise_in"
  past_lva: "what_type_does_your_practice_specialise_in"

# Practice matching configuration
practice_matching:
  company_column: "Company Name"
  practice_type_column: "Main Type of Veterinary Practice"
  match_threshold: 95
  missing_companies_output: "missing_practice_companies_lva2025.csv"

# Job role processing configuration
job_role_question: 'Job Role'

# Output file configurations
output_files:
  professions_list: "list_of_professions.csv"
  specializations: "specializations.json"
  job_roles: "job_roles.json"
  raw_data:
    main_event_registration: "Registration_data_bva.csv"
    secondary_event_registration: "Registration_data_lva.csv"
    main_event_demographic: "Registration_demographicdata_bva.csv"
    secondary_event_demographic: "Registration_demographicdata_lva.csv"
  processed_data:
    this_year: "Registration_data_bva_25_only_valid.csv"
    last_year_main: "Registration_data_bva_24_only_valid.csv"
    returning_main: "Registration_data_bva_24_25_only_valid.csv"
    returning_secondary: "Registration_data_lva_24_25_only_valid.csv"
  demographic_data:
    this_year: "Registration_demographicdata_bva_25_raw.csv"
    last_year_main: "Registration_demographicdata_bva_24_raw.csv"
    last_year_secondary: "Registration_demographicdata_lva_24_raw.csv"
  returning_demographic_data:
    main_event: "Registration_demographicdata_bva_24_25.csv"
    secondary_event: "Registration_demographicdata_lva_24_25.csv"
  registration_with_demographic:
    this_year: "Registration_data_with_demographicdata_bva_this.csv"
    last_year_main: "Registration_data_with_demographicdata_bva_last.csv"
    last_year_secondary: "Registration_data_with_demographicdata_lva_last.csv"
  concatenated_registration_data:
    this_year: "bva_registration_data_this_year.json"
    past_year_main: "bva_registration_data_past_year.json"
    past_year_secondary: "lva_registration_data_past_year.json"
  processed_demographic_data:
    this_year: "demographic_data_this.json"
    last_year_main: "demographic_data_last_bva.json"
    last_year_secondary: "demographic_data_last_lva.json"
  combined_demographic_registration:
    this_year: "df_reg_demo_this.csv"
    last_year_main: "df_reg_demo_last_bva.csv"
    last_year_secondary: "df_reg_demo_last_lva.csv"
  recommendations:
    output_directory: "recommendations"  # Subdirectory for recommendations
    filename_pattern: "visitor_recommendations_{timestamp}"  # Pattern for output files
    save_csv: true



# Pipeline control settings
create_only_new: false
  # If true, only process new visitors without recommendations

# Pipeline step activation settings
pipeline_steps:
  # Data processing steps
  registration_processing: true
  scan_processing: true  
  session_processing: true
  # Neo4j processing steps
  neo4j_visitor_processing: true
  neo4j_session_processing: true
  neo4j_job_stream_processing: true
  neo4j_specialization_stream_processing: true
  neo4j_visitor_relationship_processing: true
  session_embedding_processing: true
  session_recommendation_processing: true

# Input file paths
old_format: true
input_files:
  main_event_registration: "data/lva/20251127_eventregistration_LVS24_25_legacy.json"
  secondary_event_registration: "data/lva/20250922_registration_BVA_25.json"
  main_event_demographic: "data/lva/20251127_eventregistration_LVS24_25_demographics_legacy.json"
  secondary_event_demographic: "data/lva/20250922_demographics_BVA_25.json"
  practices: "data/lva/practices_missing.csv"


# Scan data configuration
scan_files:
  session_this: "data/lva/LVS25_session_export.csv"
  session_past_main: "data/lva/LVS24_session_export.csv"
  session_past_secondary: "data/lva/BVA25_session_export.csv"
  seminars_scan_reference_past_main: "data/lva/lvs2024 seminar scans reference.csv"
  seminars_scans_past_main: "data/lva/lvs2024 seminar scans.csv"
  seminars_scan_reference_past_secondary: "data/lva/bva25 seminar scans reference.csv"
  seminars_scans_past_secondary: "data/lva/bva25 seminar scans.csv"

# Session output file configuration
session_output_files:
  processed_sessions:
    this_year: "session_this_filtered_valid_cols.csv"
    last_year_main: "session_last_filtered_valid_cols_bva.csv"
    last_year_secondary: "session_last_filtered_valid_cols_lva.csv"
  streams_catalog: "streams.json"
# Session data file paths
session_files:
  session_this: "data/lva/LVS25_session_export.csv"
  session_past_bva: "data/lva/LVS24_session_export.csv"
  session_past_lva: "data/lva/BVA25_session_export.csv"

# Scan output files
scan_output_files:
  processed_scans:
    last_year_main: "scan_bva_past.csv"
    last_year_secondary: "scan_lva_past.csv"
    this_year_post: "scan_this_post.csv"
  sessions_visited:
    main_event: "sessions_visited_last_bva.csv"
    secondary_event: "sessions_visited_last_lva.csv"
    this_year_post: "sessions_visited_this_year.csv"
  # Added explicit filenames used by attended_session relationship creation logic (currently hard-coded in processor)
  attended_session_inputs:
    past_year_main_scan: "scan_bva_past.csv"            # Raw past-year main scan file actually consumed when building attended_session
    past_year_secondary_scan: "scan_lva_past.csv"       # Raw past-year secondary scan file actually consumed
    past_year_main_filter: "df_reg_demo_last_bva.csv"    # Registration+demo filter file for main past year visitors
    past_year_secondary_filter: "df_reg_demo_last_lva.csv" # Registration+demo filter file for secondary past year visitors

stream_processing:
  use_cached_descriptions: false
  create_missing_streams: true
  use_enhanced_streams_catalog: true 
  
# Session processing configuration
# BVA-specific titles to remove during session filtering
titles_to_remove:
  - "exhibitor showcase"
  - "tbc session"
  - "-"
  - "session tba"
  - "Session title to be confirmed"
  - "session title to be confirm"
  - "session details to follow"

# BVA-specific veterinary abbreviation mappings
map_vets:
  "RCVS": "Royal College of Veterinary Surgeons"
  "VPG": "Veterinary Pathology Group"
  "IDEXX": "IDEXX Laboratories"
  "VCMS": "Veterinary Client Mediation Service"
  "NVS": "National Veterinary Services"
  "ACD": "ACD Labs"
  "VMD": "The Veterinary Medicines Directorate"
  "TVM": "TVM Uk"
  "IVAMP": "International Veterinary Academy of Pain Management"
  "JAK": "JAK Marketing"
  "DMS": "DMS Veterinary"
  "VRS": "Veterinarian Recommended Solutions"
  "No Data": "Not Sponsored"
  "BVZS": "British Veterinary Zoological Society"
  "BSAVA": "British Small Animal Veterinary Association"
  "BCVA": "Bristol Commercial Valuers and Auctioneers"
  "PVS": "Pig Veterinary Society"
  "BVPA": "British Veterinary Poultry Association"
  "BBVA": "British Bee Veterinary Association"
  "BVCS": "Bachelor of Veterinary Science"
  "BVDA": "British Veterinary Dental Association"
  "DEFRA": "Department for Environment, Food & Rural Affairs"
  "Agria": "Agria Pet Insurance Limited"
  "Cubex": "Veterinary Practice Software"
  "Forte": "Forte Healthcare Ltd"
  "Lupa": "LUPA PETS LTD"
  "iM3": "iM3 The Global Name in Veterinary Dentistry"
  "Omni": "Omni Pet Limited"
  "WVS" : "Worldwide Veterinary Service"
  "BVCIS": "British Veterinary Chronic Illness Support"
  "Covet": "Copolit for Veterinary"
  "IVAPM": "International Veterinary Academy of Pain Management"
  "KRKA": "KRKA Pharmaceutical"
  "VESH": "VETERINARY EMERGENCY AND SPECIALTY HOSPITAL LONDON"
  "MWI": "MWI Animal Health"
  "AITEM": "Artificial Intelligence Technologies Multipurpose"
  "Vedis": "Vedis Laboratories"

# Embedding configuration
embeddings:
  model: "all-MiniLM-L6-v2"     # Model to use for generating session embeddings
  batch_size: 100               # Batch size for processing embeddings
  include_stream_descriptions: false  # Whether to include stream descriptions in embeddings

# Session recommendation configuration

recommendation:
  min_similarity_score: 0.3       # Minimum similarity score (0.0-1.0) for recommendations
  max_recommendations: 10         # Maximum number of recommendations per visitor
  similar_visitors_count: 3       # Number of similar visitors to consider for new visitors
  resolve_overlapping_sessions_by_similarity: true  # Resolve clashing sessions by keeping the highest similarity ones
  control_group:                  # Control-group defaults (only active in personal_agendas mode)
    enabled: true
    percentage: 5                 # Expressed as percent (5 => 5%)
    random_seed: 42
    file_suffix: "_control"
    output_directory: "recommendations/control"
    neo4j_property: "control_group"
    
  returning_without_history:
    enabled: true                  # Adjust similarity scores for returning visitors with no past attendance
    similarity_exponent: 1.5       # Exponent applied to similarity values when triggered
  use_langchain: false            # Whether to use LangChain for filtering (requires LangChain)
  enable_filtering: true          # Enable/disable filtering rules (true for vet shows)
  theatre_capacity_limits:
    enabled: true
    capacity_file: "data/lva/teatres.csv"
    session_file: "data/lva/LVS25_session_export.csv"
    capacity_multiplier: 3.0
  # Additional visitor fields to include directly in exported recommendations CSV (enrichment)
  export_additional_visitor_fields:
    - Email
    - Forename
    - Surname
    - Tel
    - Mobile
    - Company
    - JobTitle
    - Email_domain
    - Country
    - Source

  # Similarity attributes for finding similar visitors (vet-specific)
  similarity_attributes:
    job_role: .8                                        # Weight for job role matching
    what_type_does_your_practice_specialise_in: .8     # Weight for practice type
    organisation_type: .8                             # Weight for organization type
    Country: .5                                          # Weight for country

  role_groups:
    vet_roles:
      - "Vet/Vet Surgeon"
      - "Assistant Vet"
      - "Vet/Owner"
      - "Clinical or other Director"
      - "Locum Vet"
      - "Academic"
    nurse_roles:
      - "Head Nurse/Senior Nurse"
      - "Vet Nurse"
      - "Locum RVN"
    business_roles:
      - "Practice Manager"
      - "Practice Partner/Owner"
    other_roles:
      - "Student"
      - "Receptionist"
      - "Other (please specify)"
      - "Other"
  
  # NEW: Add field mappings
  field_mappings:
    practice_type_field: "what_type_does_your_practice_specialise_in"
    job_role_field: "job_role"
  
  # Filtering rules configuration (vet-specific)
  rules_config:
    equine_mixed_exclusions: ["exotics", "feline", "exotic animal", "farm", "small animal"]
    small_animal_exclusions: ["equine", "farm animal", "farm", "large animal"]
    vet_exclusions: ["nursing"]
    nurse_streams: ["nursing", "wellbeing", "welfare"]
    rule_priority: ["practice_type", "role"]  # Order of rule application
    custom_rules:
      enabled: true
      apply_to_events: ["lva", "bva"]
      rules:
        - name: "vet_equine_session_requires_equine_keywords"
          enabled: true
          params:
            stream_keywords: ["equine"]
            visitor_fields: ["Company", "JobTitle"]
            required_keywords: ["horse", "equine", "mixed"]
        - name: "vet_equine_visitors_block_feline_sessions"
          enabled: true
          params:
            visitor_fields: ["Company", "JobTitle"]
            visitor_keywords: ["equine", "horse"]
            blocked_session_title_keywords: ["cat", "dog", "feline"]

# Neo4j configuration
neo4j:
  environment: "prod"
  show_name: "lva"  
  node_labels:
    visitor_this_year: "Visitor_this_year"
    visitor_last_year_bva: "Visitor_last_year_bva"
    visitor_last_year_lva: "Visitor_last_year_lva"
    session_this_year: "Sessions_this_year"
    session_past_year: "Sessions_past_year"
    stream: "Stream"
    show_this_year: "Show_this_year"
  unique_identifiers:
    visitor: "BadgeId"  # Field to use as unique identifier for visitor nodes
    session: "session_id"  # Field to use as unique identifier for session nodes
    stream: "stream"  # Field to use as unique identifier for stream nodes
    show: "show_ref"
  relationships:
    session_stream: "HAS_STREAM"  # Relationship between sessions and streams
    job_stream: "job_to_stream"  # Relationship between job roles and streams
    specialization_stream: "specialization_to_stream"  # Relationship between specializations and streams
    same_visitor: "Same_Visitor"  # Relationship between visitors this year and last year
    attended_session: "attended_session"  # Relationship between visitors and sessions they attended
    assisted_session_this_year: "assisted_session_this_year"
    registered_to_show: "registered_to_show"
  
  # ENHANCED: Job stream mapping configuration with enable support
  job_stream_mapping:
    enabled: true  # ENHANCED: Enable job stream processing for BVA shows
    file: "job_to_stream.csv"  # File containing job to stream mappings
    job_role_field: "job_role"  # Field containing job role information
    
  # ENHANCED: Specialization stream mapping configuration with enable support
  specialization_stream_mapping:
    enabled: true  # ENHANCED: Enable specialization stream processing for BVA shows
    file: "spezialization_to_stream.csv"  # File containing specialization to stream mapping
    specialization_field_this_year: "what_type_does_your_practice_specialise_in"
    specialization_field_bva: "what_areas_do_you_specialise_in"
    specialization_field_lva: "what_type_does_your_practice_specialise_in"
    # For LVA correct mappings are applyed using vet-specific logic in processor
    specialization_map_this_year: {}  # Empty - no transformation needed
    
    # For last year BVA visitors (need to map 2024 BVA terms to 2025 terms)
    specialization_map_last_year_bva:
      "Companion Animal": "Small Animal"  # Most critical mapping
      "Cattle": "Farm"
      "Dairy": "Farm"
      "Pigs": "Farm"
      "Poultry": "Farm"
      "Sheep": "Farm"
      # Note: Equine stays as Equine
      # Note: Exotics stays as Exotics
      # Note: Other stays as Other
      # Note: Farm stays as Farm
    
    # For last year LVA visitors (LVS 2024 terms)
    specialization_map_last_year_lva:
      # Based on stream_job_specialism.csv LVE 2024 column
      {}  # Empty for now, add mappings if specific terms need transformation
  
  visitor_relationship:
    same_visitor_properties:
      bva: { type: "bva" }  # Properties for BVA Same_Visitor relationships
      lva: { type: "lva" }  # Properties for LVA Same_Visitor relationships

# Default properties for visitor nodes
default_visitor_properties:
  Days_since_registration: "119"
  Country: "UK"
  Source: "BVA Key Stakeholders"
  Email_domain: "vetpractice.co.uk"
  assist_year_before: "1"
  job_role: "NA"
  what_type_does_your_practice_specialise_in: "NA"
  organisation_type: "NA"
  JobTitle: "NA"
  show: "lva"


# Environment file path
env_file: "keys/.env"

# Language model configuration
language_model:
  model: "gpt-4o-mini"
  temperature: 0.5
  top_p: 0.9

# Output directory
output_dir: "data/lva"

# Event dates
event_date_this_year: "2025-11-20"
event_date_last_year: "2024-11-20"

# Valid badge types
valid_badge_types:
  - "Delegate"
  - "Delegate - Group"
  - 'Exhibitor/Delegate'
  - 'Commercial Delegate'
  - 'Delegate - Exhibition Only'
  - 'Guest'
  - 'Student'
  - 'Speaker'
  - 'VIP'
  - 'Delegate - NPA'

# Shows for this year (for filtering)
shows_this_year:
  - "LVS25"

# Questions to keep (for demographic analysis)
questions_to_keep:
  current:
    - "What type does your practice specialise in"
    - "Organisation Type"
    - "Job Role"
  past:
    - "What areas do you specialise in"
    - "What type does your practice specialise in"
    - "Organisation Type"
    - "Job Role"

# Logging configuration
logging:
  level: "INFO"
  file: "data_processing.log"