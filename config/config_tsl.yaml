# Event-specific configuration for BVA events
# This configuration file contains all event-specific settings and output file names
# 15122025 test control group
mode: "personal_agendas"  # can be engagement or personal_agendas
# Event configuration 
event:
  name: "tsl"
  main_event: "tsl"
  main_event_name: "tsl"  # This will trigger vet-specific functions
  secondary_event_name: "tsl_secondary"
  year: 2026
  shows_this_year:
    - [ 'DCWL26','DAILS26', 'CAIL26', 'CCSEL26', 'DOLL26']
  shows_last_year_main:
    - ['CCSEL25', 'DCWL25', 'BDAWL25', 'DL25', 'CEEL25']
  shows_last_year_secondary:
    - ['DCWL24', 'CCSEL24', 'BDAWL24', 'CEEL24', 'DL24']

# Documentation assets surfaced by the application
documentation:
  generic_pipeline_map: "docs/generic_pipeline_map.svg"
  show_pipeline_map: "docs/vet_pipeline_map.svg"

post_analysis_mode:
  registration_shows:
    this_year_main:
      - ['DCWL26','DAILS26', 'CAIL26', 'CCSEL26', 'DOLL26']
  scan_files:
    seminars_scan_reference_this: "data/tsl/post/lvs25 seminar scans reference.csv"
    seminars_scans_this: "data/tsl/post/lvs25 seminar scans.csv"
  entry_scan_files:
    entry_scans_this: ["data/tsl/post/lvs25_unfiltered_entry_scans.csv"]  

# Badge history column names
badge_history_columns:
  main_event: "BadgeId_last_year_bva"
  secondary_event: "BadgeId_last_year_lva"

# Practice type column names for different years
practice_type_columns:
  current: "what_type_does_your_practice_specialise_in"
  past_bva: "what_areas_do_you_specialise_in"
  past_lva: "what_type_does_your_practice_specialise_in"

# Practice matching configuration
practice_matching:
  company_column: "Company Name"
  practice_type_column: "Main Type of Veterinary Practice"
  match_threshold: 95
  missing_companies_output: "missing_practice_companies_lva2025.csv"

# Job role processing configuration
job_role_question: 'Job Role'

# Output file configurations
output_files:
  professions_list: "list_of_professions.csv"
  specializations: "specializations.json"
  job_roles: "job_roles.json"
  raw_data:
    main_event_registration: "Registration_data_bva.csv"
    secondary_event_registration: "Registration_data_lva.csv"
    main_event_demographic: "Registration_demographicdata_bva.csv"
    secondary_event_demographic: "Registration_demographicdata_lva.csv"
  processed_data:
    this_year: "Registration_data_bva_25_only_valid.csv"
    last_year_main: "Registration_data_bva_24_only_valid.csv"
    returning_main: "Registration_data_bva_24_25_only_valid.csv"
    returning_secondary: "Registration_data_lva_24_25_only_valid.csv"
  demographic_data:
    this_year: "Registration_demographicdata_bva_25_raw.csv"
    last_year_main: "Registration_demographicdata_bva_24_raw.csv"
    last_year_secondary: "Registration_demographicdata_lva_24_raw.csv"
  returning_demographic_data:
    main_event: "Registration_demographicdata_bva_24_25.csv"
    secondary_event: "Registration_demographicdata_lva_24_25.csv"
  registration_with_demographic:
    this_year: "Registration_data_with_demographicdata_bva_this.csv"
    last_year_main: "Registration_data_with_demographicdata_bva_last.csv"
    last_year_secondary: "Registration_data_with_demographicdata_lva_last.csv"
  concatenated_registration_data:
    this_year: "bva_registration_data_this_year.json"
    past_year_main: "bva_registration_data_past_year.json"
    past_year_secondary: "lva_registration_data_past_year.json"
  processed_demographic_data:
    this_year: "demographic_data_this.json"
    last_year_main: "demographic_data_last_bva.json"
    last_year_secondary: "demographic_data_last_lva.json"
  combined_demographic_registration:
    this_year: "df_reg_demo_this.csv"
    last_year_main: "df_reg_demo_last_bva.csv"
    last_year_secondary: "df_reg_demo_last_lva.csv"
  recommendations:
    output_directory: "recommendations"  # Subdirectory for recommendations
    filename_pattern: "visitor_recommendations_{timestamp}"  # Pattern for output files
    save_csv: true
    save_json: false  # New parameter to control big JSON export



# Pipeline control settings
create_only_new: false
  # If true, only process new visitors without recommendations

# Pipeline step activation settings
pipeline_steps:
  # Data processing steps
  registration_processing: false
  scan_processing: false  
  session_processing: false
  # Neo4j processing steps
  neo4j_visitor_processing: true
  neo4j_session_processing: true
  neo4j_job_stream_processing: true
  neo4j_specialization_stream_processing: true
  neo4j_visitor_relationship_processing: true
  session_embedding_processing: true
  session_recommendation_processing: true
  output_processing: true

# Input file paths
old_format: true
input_files:
  main_event_registration: "data/tsl/20260120_tsl25_26_registration_legacy.json"
  secondary_event_registration: "data/tsl/20260120_tsl24_registration_legacy.json"
  main_event_demographic: "data/tsl/20260120_tsl25_26_demographics_legacy.json"
  secondary_event_demographic: "data/tsl/20260120_tsl24_demographics_legacy.json"
  practices: "data/tsl/practices_missing.csv"


# Scan data configuration
scan_files:
  session_this: "data/tsl/TSL2026_session_export.csv"
  session_past_main: "data/tsl/TSL2025_session_export.csv"
  session_past_secondary: "data/tsl/TSL2024_session_export.csv"
  seminars_scan_reference_past_main: "data/tsl/tech london 2025 seminars reference.csv"
  seminars_scans_past_main: "data/tsl/tech london 2025 seminars.csv"
  seminars_scan_reference_past_secondary: "data/tsl/tech london 2024 seminars reference.csv"
  seminars_scans_past_secondary: "data/tsl/tech london 2024 seminars.csv"

# Session output file configuration
session_output_files:
  processed_sessions:
    this_year: "session_this_filtered_valid_cols.csv"
    last_year_main: "session_last_filtered_valid_cols_bva.csv"
    last_year_secondary: "session_last_filtered_valid_cols_lva.csv"
  streams_catalog: "streams.json"
# Session data file paths
session_files:
  session_this: "data/tsl/TSL2026_session_export.csv"
  session_past_bva: "data/tsl/TSL2025_session_export.csv"
  session_past_lva: "data/tsl/TSL2024_session_export.csv"

# Scan output files
scan_output_files:
  processed_scans:
    last_year_main: "scan_bva_past.csv"
    last_year_secondary: "scan_lva_past.csv"
    this_year_post: "scan_this_post.csv"
  sessions_visited:
    main_event: "sessions_visited_last_bva.csv"
    secondary_event: "sessions_visited_last_lva.csv"
    this_year_post: "sessions_visited_this_year.csv"
  # Added explicit filenames used by attended_session relationship creation logic (currently hard-coded in processor)
  attended_session_inputs:
    past_year_main_scan: "scan_bva_past.csv"            # Raw past-year main scan file actually consumed when building attended_session
    past_year_secondary_scan: "scan_lva_past.csv"       # Raw past-year secondary scan file actually consumed
    past_year_main_filter: "df_reg_demo_last_bva.csv"    # Registration+demo filter file for main past year visitors
    past_year_secondary_filter: "df_reg_demo_last_lva.csv" # Registration+demo filter file for secondary past year visitors

stream_processing:
  use_cached_descriptions: false
  create_missing_streams: true
  use_enhanced_streams_catalog: true 
  
# Session processing configuration
# BVA-specific titles to remove during session filtering
titles_to_remove:
  - "exhibitor showcase"
  - "tbc session"
  - "-"
  - "session tba"
  - "Session title to be confirmed"
  - "session title to be confirm"
  - "session details to follow"
  - "chair's opening remarks"
  - "chairs closing remarks"
  - 'panel to be confirmed'
  - 'tbs session'
  - 'session details to follow'
  - 'session to be confirmed'
  - "chair's closing remarks"
  - 'sponsored session to be confirmed'
  - 'sponsored session tbc'
  - 'opening remarks - theatre chair'
  - 'closing remarks - theatre chair'

# TSL abbreviation mappings
map_vets:
    "ABB": "ABB"
    "IBM": "IBM"
    "AFL": "AFL"
    "DDC": "DDC TECHNOLOGIES LTD"
    "NVS": "National Veterinary Services"
    "QA": "QA TECHNOLOGY LTD"
    "R&M": "Reichle & De-Massari AG"
    "RIT": "RIT Tech"
    "SAP": "SAP"

# Embedding configuration
embeddings:
  model: "all-MiniLM-L6-v2"     # Model to use for generating session embeddings
  batch_size: 100               # Batch size for processing embeddings
  include_stream_descriptions: false  # Whether to include stream descriptions in embeddings

# Session recommendation configuration

recommendation:
  min_similarity_score: 0.3       # Minimum similarity score (0.0-1.0) for recommendations
  max_recommendations: 10         # Maximum number of recommendations per visitor
  similar_visitors_count: 3       # Number of similar visitors to consider for new visitors
  resolve_overlapping_sessions_by_similarity: true  # Resolve clashing sessions by keeping the highest similarity ones
  use_calculated_days_since_registration: false  # If true, use calculated Days_since_registration; if false, set all to 1
  parallel_processing:
    enabled: true                 # Enable parallel processing of visitors
    max_workers: 4                # Maximum number of parallel workers (adjust based on system resources)
  external_recommendations:
    enabled: false
    file: "data/tsl/v2e_recommendations_2.json"
  control_group:                  # Control-group defaults (only active in personal_agendas mode)
    enabled: true
    percentage: 5                 # Expressed as percent (5 => 5%)
    random_seed: 42
    file_suffix: "_control"
    output_directory: "recommendations/control"
    neo4j_property: "control_group"
    
  returning_without_history:
    enabled: true                  # Adjust similarity scores for returning visitors with no past attendance
    similarity_exponent: 1.5       # Exponent applied to similarity values when triggered
  use_langchain: false            # Whether to use LangChain for filtering (requires LangChain)
  enable_filtering: false          # Enable/disable filtering rules (true for vet shows)
  # ENHANCED: Theatre capacity limits configuration 
  theatre_capacity_limits:
    enabled: false
    capacity_file: "data/tsl/teatres.csv"
    session_file: "data/tsl/LVS25_session_export.csv"
    capacity_multiplier: 3.0
  # Additional visitor fields to include directly in exported recommendations CSV (enrichment)
  export_additional_visitor_fields:
    - Email
    - Forename
    - Surname
    - Tel
    - Mobile
    - Company
    - JobTitle
    - Email_domain
    - Country
    - Source
    - BadgeType
    - Days_since_registration

  # Minimal CSV export configuration
  export_csv_minimal:
    enabled: true  # If true, export only the specified fields; if false, export all fields
    fields:
      - visitor_id
      - Email
      - session_title
      - session_date
      - session_start_time
      - BadgeType
      - session_theatre_name

  # Similarity attributes for finding similar visitors and calculating similarity scores (with weights for each attribute)
  similarity_attributes:
    # Weights for similarity attributes (sum should ideally be 1.0, but can be adjusted based on importance)
    # REMOVED: Low fill rate (13.2%) - what_is_your_primary_show_of_interest_your_badge_will_work_for_all_colocated_shows: .1 
    # REMOVED: Low fill rate (8.5%) - within_the_tech_ecosystem_my_public_sector_organisation_primarily_operates_as_please_select_the_option_that_best_describes_your_main_role: .1    
    # For TSL, sector is a key differentiator among attendees, so we assign it a higher weight to reflect its importance in determining similarity. The exact value can be fine-tuned based on testing and domain expertise.
    which_sector_does_your_company_primarily_operate_in: .8     
    # For TSL, Country is not a major factor in attendee similarity due to the international nature of the event and the dominance of UK-based attendees, so we assign it a low weight. The exact value can be adjusted based on testing and domain knowledge.
    Country: .3  
    # For TSL, involvement in decision-making is an important factor for similarity as it can indicate the level of influence and engagement of the attendee, so we assign it a moderate weight. The exact value can be fine-tuned based on testing and domain expertise.
    what_is_your_involvment_in_the_decision_making_process: .5      
    # For TSL, seniority level is a significant factor in determining similarity among attendees, as it can reflect their level of experience and influence within their organizations, so we assign it a moderate to high weight. The exact value can be adjusted based on testing and domain knowledge.
    which_of_the_following_best_describes_your_current_seniority_level: .6
    # For TSL, representation type is less critical for similarity compared to other attributes, as attendees from various representation types can have similar interests and behaviors at the event, so we assign it a lower weight. The exact value can be fine-tuned based on testing and domain expertise.
    you_are_representing: .4
    # For TSL, professional function is an important factor for similarity as it can indicate the attendee's area of expertise and the type of sessions they may be interested in, so we assign it a moderate weight. The exact value can be adjusted based on testing and domain knowledge.
    which_of_the_following_best_describes_your_primary_professional_function_if_you_are_a_consultant_please_select_the_main_area_in_which_you_provide_expertise_or_services_select_one: .9  # Weight for professional function

  role_groups: {}

  
  # NEW: Add field mappings
  field_mappings:
    practice_type_field: "what_type_does_your_practice_specialise_in"
    job_role_field: "job_role"
  
  # Filtering rules configuration (vet-specific)
    rules_config: {}


# Neo4j configuration
neo4j:
  environment: "prod"
  show_name: "tsl"  
  node_labels:
    visitor_this_year: "Visitor_this_year"
    visitor_last_year_bva: "Visitor_last_year_bva"
    visitor_last_year_lva: "Visitor_last_year_lva"
    session_this_year: "Sessions_this_year"
    session_past_year: "Sessions_past_year"
    stream: "Stream"
    show_this_year: "Show_this_year"
  unique_identifiers:
    visitor: "BadgeId"  # Field to use as unique identifier for visitor nodes
    session: "session_id"  # Field to use as unique identifier for session nodes
    stream: "stream"  # Field to use as unique identifier for stream nodes
    show: "show_ref"
  relationships:
    session_stream: "HAS_STREAM"  # Relationship between sessions and streams
    job_stream: "job_to_stream"  # Relationship between job roles and streams
    specialization_stream: "specialization_to_stream"  # Relationship between specializations and streams
    same_visitor: "Same_Visitor"  # Relationship between visitors this year and last year
    attended_session: "attended_session"  # Relationship between visitors and sessions they attended
    assisted_session_this_year: "assisted_session_this_year"
    registered_to_show: "registered_to_show"
  
  # ENHANCED: Job stream mapping configuration with enable support
  job_stream_mapping:
    enabled: false  # ENHANCED: Enable job stream processing for BVA shows
    file: "job_to_stream.csv"  # File containing job to stream mappings
    job_role_field: "job_role"  # Field containing job role information
    
  # ENHANCED: Specialization stream mapping configuration with enable support
  specialization_stream_mapping:
    enabled: false  # ENHANCED: Enable specialization stream processing for BVA shows
    file: "spezialization_to_stream.csv"  # File containing specialization to stream mapping
    specialization_field_this_year: "what_type_does_your_practice_specialise_in"
    specialization_field_bva: "what_areas_do_you_specialise_in"
    specialization_field_lva: "what_type_does_your_practice_specialise_in"

    # For TSL correct mappings are applyed using vet-specific logic in processor
    specialization_map_this_year: {}  # Empty - no transformation needed
    
    # For last year TSL visitors (need to map 2024 TSL terms to 2025 terms)
    specialization_map_last_year_bva: {}

    # For last year TSL visitors (TSL 2024 terms)
    specialization_map_last_year_lva:
      # Based on stream_job_specialism.csv LVE 2024 column
      {}  # Empty for now, add mappings if specific terms need transformation
  
  visitor_relationship:
    same_visitor_properties:
      bva: { type: "tsl" }  # Properties for TSL Same_Visitor relationships
      lva: { type: "tsl_secondary" }  # Properties for TSL Same_Visitor relationships

# Default properties for visitor nodes
default_visitor_properties:
  Days_since_registration: "119"
  Country: "UK"
  Source: "BVA Key Stakeholders"
  Email_domain: "vetpractice.co.uk"
  assist_year_before: "1"
  what_is_your_primary_show_of_interest_your_badge_will_work_for_all_colocated_shows: "NA"
  within_the_tech_ecosystem_my_public_sector_organisation_primarily_operates_as_please_select_the_option_that_best_describes_your_main_role: "NA"
  which_sector_does_your_company_primarily_operate_in: "NA"
  Country: "NA"
  what_is_your_involvment_in_the_decision_making_process: "NA"
  which_of_the_following_best_describes_your_current_seniority_level: "NA"
  you_are_representing: "NA"
  which_of_the_following_best_describes_your_primary_professional_function_if_you_are_a_consultant_please_select_the_main_area_in_which_you_provide_expertise_or_services_select_one: "NA"
  JobTitle: "NA"
  show: "tsl"


# Environment file path
env_file: "keys/.env"

# Language model configuration
language_model:
  model: "gpt-4o-mini"
  temperature: 0.5
  top_p: 0.9

# Output directory
output_dir: "data/tsl"

# Event dates
event_date_this_year: "2026-03-04"
event_date_last_year: "2025-03-12"

# Valid badge types
valid_badge_types:
  - 'VISITOR'
  - 'Visitor'
  - 'AUTO Visitor'
  - 'VIP'


# Shows for this year (for filtering)
shows_this_year:
  - "TSL2026"

# Questions to keep (for demographic analysis)
questions_to_keep:
  current:
    - 'what is your primary show of interest your badge will work for all colocated shows'
    - 'within the tech ecosystem my public sector organisation primarily operates as please select the option that best describes your main role'
    - 'which sector does your company primarily operate in'
    - 'what is your involvment in the decision making process'
    - 'which of the following best describes your current seniority level'
    - 'you are representing'
    -  'which of the following best describes your primary professional function if you are a consultant please select the main area in which you provide expertise or services select one'
  past:
    - 'Job Level'
    - 'Please specify your industry sector Service'
    - 'Job Function'
    - 'Decision making power'
    - 'Your organisation industry sector'

# Logging configuration
logging:
  level: "INFO"
  file: "data_processing.log"